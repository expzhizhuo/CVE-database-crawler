import time
import requests
import re
import datetime
import pymysql
from time import gmtime, strftime
import random


def info(count,name):
    print('爬取厂商：'+name)
    base_url='https://cve.mitre.org/cgi-bin/cvekey.cgi?keyword='+name
    headers = {
    'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9',
    'Accept-Encoding': 'gzip, deflate, br',
    'Accept-Language': 'zh-CN,zh;q=0.9',
    'Cache-Control': 'max-age=0',
    # 'Connection': 'keep-alive',
    'Host': 'cve.mitre.org',
    'Referer': 'https://cve.mitre.org/cve/search_cve_list.html',
    'sec-ch-ua': '" Not A;Brand";v="99", "Chromium";v="96", "Google Chrome";v="96"',
    'sec-ch-ua-mobile': '?0',
    'sec-ch-ua-platform': '"Windows"',
    'Sec-Fetch-Dest': 'document',
    'Sec-Fetch-Mode': 'navigate',
    'Sec-Fetch-Site': 'same-origin',
    'Sec-Fetch-User': '?1',
    'Upgrade-Insecure-Requests': '1',
    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.110 Safari/537.36'
    }
    resp=requests.get(base_url,headers=headers,timeout=120)
    if resp.status_code == 200:
        cvenum=re.findall('<a href=".*?">(.*?)</a></td>',resp.text,re.M)
        print(len(cvenum))
        print('================================')
        Description=re.compile('<td valign="top">(.*?)</td>',re.S).findall(resp.text)
        print(len(Description))
        print('================================')

        for i in range(0,len(cvenum)):
            cvenumbe=cvenum[i]
            # cvenumbe='CVE-2021-31385'
            Descriptiontxt=Description[i].replace('\n','')
            print(cvenumbe,Descriptiontxt)
            cveinfo(cvenumbe,Descriptiontxt,name)
            count=count+1
        print('================================')
        print('共爬取：'+str(count)+'次')
    else:
        pass
    
    
        

def cveinfo(cvenumbe,Descriptiontxt,name):
    base_url='https://nvd.nist.gov/vuln/detail/'+cvenumbe
    header={
        'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9',
        'Accept-Encoding': 'gzip, deflate, br',
        'Accept-Language': 'zh-CN,zh;q=0.9',
        'Cache-Control': 'max-age=0',
        # 'Connection': 'keep-alive',
        'Cookie': '__utma=141729133.1858053219.1638156451.1641461481.1641542709.11; __utmc=141729133; __utmz=141729133.1641542709.11.7.utmcsr=cve.mitre.org|utmccn=(referral)|utmcmd=referral|utmcct=/',
        'Host': 'nvd.nist.gov',
        'Referer': 'https://cve.mitre.org/',
        'sec-ch-ua': '" Not A;Brand";v="99", "Chromium";v="96", "Google Chrome";v="96"',
        'sec-ch-ua-mobile': '?0',
        'sec-ch-ua-platform': '"Windows"',
        'Sec-Fetch-Dest': 'document',
        'Sec-Fetch-Mode': 'navigate',
        'Sec-Fetch-Site': 'cross-site',
        'Sec-Fetch-User': '?1',
        'Upgrade-Insecure-Requests': 'Upgrade-Insecure-Requests',
        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.110 Safari/537.36'
    }
    resp=requests.get(url=base_url,headers=header,timeout=120)
    print(re.findall('data-testid="vuln-cvss3-source-nvd">(.*?)</span>',resp.text))
    if resp.status_code == 200:
        print(cvenumbe)#cve编号
        print(Descriptiontxt)#描述
        resp=requests.get(url=base_url,headers=header,timeout=120)
        # print(resp.text)
        NIST=re.findall('data-testid="vuln-cvss3-source-nvd">(.*?)</span>',resp.text)
        print(NIST)
        if len(NIST)<1:
            NISTname=''
            ################################################################
            print(NISTname)#NVD名字
            Score=re.findall('class="label label-.*?">(.*?)</a>',resp.text)
            if len(Score)<1:
                pass
            if len(Score)==2 :
                ScoreCNAnum=Score[0].split(' ')[0]#NVDv3分数
                Scorev2=Score[1].split(' ')[0]#NVDv2分数
                CNA=re.findall('data-testid="vuln-cvss3-source-cna">(.*?)</span>',resp.text)
                NVD_Published_Date=re.findall('vuln-published-on">(.*?)</span>',resp.text)
                if len(NVD_Published_Date)==0:
                    pass
                Published_yesr=int(NVD_Published_Date[0].split('/')[2])
                Published_month=int(NVD_Published_Date[0].split('/')[0])
                Published_day=int(NVD_Published_Date[0].split('/')[1])
                NVD_Published_Date_time=datetime.date(Published_yesr,Published_month,Published_day)
                if len(CNA)<1:
                    CNAname=''
                else:
                    CNAname=CNA[0]
                print(CNAname)#CNA名字
                Scorev3=''
                print('NVDV3:'+Scorev3,'CNA:'+ScoreCNAnum,'NVDV2:'+Scorev2)#分数
                print(NVD_Published_Date_time)#发布日期
                NVD_Last_Modified=re.findall('vuln-last-modified-on">(.*?)</span>',resp.text)
                if len(NVD_Last_Modified)==0:
                    pass
                Last_year=int(NVD_Last_Modified[0].split('/')[2])
                Last_month=int(NVD_Last_Modified[0].split('/')[0])
                Last_day=int(NVD_Last_Modified[0].split('/')[1])
                NVD_Last_Modified=datetime.date(Last_year,Last_month,Last_day)
                print(NVD_Last_Modified)#最后修改日期
                Source=re.findall('vuln-current-description-source">(.*?)</span>',resp.text)
                timenow=strftime("%Y-%m-%d %H:%M:%S", gmtime())
                print(timenow)
                id=''
                if len(Source)==0:
                    pass
                Sourcewho=Source[0]
                print(Sourcewho)#发布者
                mysqlin(id,cvenumbe,Descriptiontxt,NISTname,Scorev3,CNAname,ScoreCNAnum,Scorev2,NVD_Published_Date_time,NVD_Last_Modified,Sourcewho,name,timenow)
            if len(Score)==1 :
                # ScoreCNAnum=Score[0].split(' ')[0]#NVDv3分数
                Scorev2=Score[1].split(' ')[0]#NVDv2分数
                CNA=re.findall('data-testid="vuln-cvss3-source-cna">(.*?)</span>',resp.text)
                NVD_Published_Date=re.findall('vuln-published-on">(.*?)</span>',resp.text)
                if len(NVD_Published_Date)==0:
                    pass
                Published_yesr=int(NVD_Published_Date[0].split('/')[2])
                Published_month=int(NVD_Published_Date[0].split('/')[0])
                Published_day=int(NVD_Published_Date[0].split('/')[1])
                NVD_Published_Date_time=datetime.date(Published_yesr,Published_month,Published_day)
                if len(CNA)<1:
                    CNAname=''
                else:
                    CNAname=CNA[0]
                print(CNAname)#CNA名字
                Scorev3=''
                ScoreCNAnum=''
                print('NVDV3:'+Scorev3,'CNA:'+ScoreCNAnum,'NVDV2:'+Scorev2)#分数
                print(NVD_Published_Date_time)#发布日期
                NVD_Last_Modified=re.findall('vuln-last-modified-on">(.*?)</span>',resp.text)
                if len(NVD_Last_Modified)==0:
                    pass
                Last_year=int(NVD_Last_Modified[0].split('/')[2])
                Last_month=int(NVD_Last_Modified[0].split('/')[0])
                Last_day=int(NVD_Last_Modified[0].split('/')[1])
                NVD_Last_Modified=datetime.date(Last_year,Last_month,Last_day)
                print(NVD_Last_Modified)#最后修改日期
                Source=re.findall('vuln-current-description-source">(.*?)</span>',resp.text)
                timenow=strftime("%Y-%m-%d %H:%M:%S", gmtime())
                print(timenow)
                id=''
                if len(Source)==0:
                    pass
                Sourcewho=Source[0]
                print(Sourcewho)#发布者
                mysqlin(id,cvenumbe,Descriptiontxt,NISTname,Scorev3,CNAname,ScoreCNAnum,Scorev2,NVD_Published_Date_time,NVD_Last_Modified,Sourcewho,name,timenow)
            # if len(Score)==0 :
                # ScoreCNAnum=Score[0].split(' ')[0]#NVDv3分数
                # Scorev2=Score[1].split(' ')[0]#NVDv2分数
            #     CNA=re.findall('data-testid="vuln-cvss3-source-cna">(.*?)</span>',resp.text)
            #     NVD_Published_Date=re.findall('vuln-published-on">(.*?)</span>',resp.text)
            #     if len(NVD_Published_Date)==0:
            #         pass
            #     Published_yesr=int(NVD_Published_Date[0].split('/')[2])
            #     Published_month=int(NVD_Published_Date[0].split('/')[0])
            #     Published_day=int(NVD_Published_Date[0].split('/')[1])
            #     NVD_Published_Date_time=datetime.date(Published_yesr,Published_month,Published_day)
            #     CNAname=CNA[0]
            #     print(CNAname)#CNA名字
            #     Scorev3=''
            #     Scorev2=''
            #     ScoreCNAnum=''
            #     print('NVDV3:'+Scorev3,'CNA:'+ScoreCNAnum,'NVDV2:'+Scorev2)#分数
            #     print(NVD_Published_Date_time)#发布日期
            #     NVD_Last_Modified=re.findall('vuln-last-modified-on">(.*?)</span>',resp.text)
            #     if len(NVD_Last_Modified)==0:
            #         pass
            #     Last_year=int(NVD_Last_Modified[0].split('/')[2])
            #     Last_month=int(NVD_Last_Modified[0].split('/')[0])
            #     Last_day=int(NVD_Last_Modified[0].split('/')[1])
            #     NVD_Last_Modified=datetime.date(Last_year,Last_month,Last_day)
            #     print(NVD_Last_Modified)#最后修改日期
            #     Source=re.findall('vuln-current-description-source">(.*?)</span>',resp.text)
            #     timenow=strftime("%Y-%m-%d %H:%M:%S", gmtime())
            #     print(timenow)
            #     id=''
            #     if len(Source)==0:
            #         pass
            #     Sourcewho=Source[0]
            #     print(Sourcewho)#发布者
            #     mysqlin(id,cvenumbe,Descriptiontxt,NISTname,Scorev3,CNAname,ScoreCNAnum,Scorev2,NVD_Published_Date_time,NVD_Last_Modified,Sourcewho,name,timenow)
            #++++++++++++++++++++++++++++++++++
        else:
            NISTname=NIST[0]
            print(NIST[0])#NVD名字
            Score=re.findall('class="label label-.*?">(.*?)</a>',resp.text)
            if len(Score)<1:
                pass
            if len(Score)==2 :
                Scorev3=Score[0].split(' ')[0]#NVDv3分数
                Scorev2=Score[1].split(' ')[0]#NVDv2分数
                CNA=re.findall('data-testid="vuln-cvss3-source-cna">(.*?)</span>',resp.text)
                NVD_Published_Date=re.findall('vuln-published-on">(.*?)</span>',resp.text)
                if len(NVD_Published_Date)==0:
                    pass
                Published_yesr=int(NVD_Published_Date[0].split('/')[2])
                Published_month=int(NVD_Published_Date[0].split('/')[0])
                Published_day=int(NVD_Published_Date[0].split('/')[1])
                NVD_Published_Date_time=datetime.date(Published_yesr,Published_month,Published_day)
                CNAname=''
                print(CNAname)#CNA名字
                ScoreCNAnum=''
                print('NVDV3:'+Scorev3,'CNA:'+ScoreCNAnum,'NVDV2:'+Scorev2)#分数
                print(NVD_Published_Date_time)#发布日期
                NVD_Last_Modified=re.findall('vuln-last-modified-on">(.*?)</span>',resp.text)
                if len(NVD_Last_Modified)==0:
                    pass
                Last_year=int(NVD_Last_Modified[0].split('/')[2])
                Last_month=int(NVD_Last_Modified[0].split('/')[0])
                Last_day=int(NVD_Last_Modified[0].split('/')[1])
                NVD_Last_Modified=datetime.date(Last_year,Last_month,Last_day)
                print(NVD_Last_Modified)#最后修改日期
                Source=re.findall('vuln-current-description-source">(.*?)</span>',resp.text)
                timenow=strftime("%Y-%m-%d %H:%M:%S", gmtime())
                print(timenow)
                id=''
                if len(Source)==0:
                    pass
                Sourcewho=Source[0]
                print(Sourcewho)#发布者
                mysqlin(id,cvenumbe,Descriptiontxt,NISTname,Scorev3,CNAname,ScoreCNAnum,Scorev2,NVD_Published_Date_time,NVD_Last_Modified,Sourcewho,name,timenow)
            if len(Score)==1 :
                # ScoreCNAnum=Score[0].split(' ')[0]#NVDv3分数
                Scorev2=Score[1].split(' ')[0]#NVDv2分数
                CNA=re.findall('data-testid="vuln-cvss3-source-cna">(.*?)</span>',resp.text)
                NVD_Published_Date=re.findall('vuln-published-on">(.*?)</span>',resp.text)
                if len(NVD_Published_Date)==0:
                    pass
                Published_yesr=int(NVD_Published_Date[0].split('/')[2])
                Published_month=int(NVD_Published_Date[0].split('/')[0])
                Published_day=int(NVD_Published_Date[0].split('/')[1])
                NVD_Published_Date_time=datetime.date(Published_yesr,Published_month,Published_day)
                if len(CNA)<1:
                    CNAname=''
                else:
                    CNAname=CNA[0]
                print(CNAname)#CNA名字
                Scorev3=''
                ScoreCNAnum=''
                print('NVDV3:'+Scorev3,'CNA:'+ScoreCNAnum,'NVDV2:'+Scorev2)#分数
                print(NVD_Published_Date_time)#发布日期
                NVD_Last_Modified=re.findall('vuln-last-modified-on">(.*?)</span>',resp.text)
                if len(NVD_Last_Modified)==0:
                    pass
                Last_year=int(NVD_Last_Modified[0].split('/')[2])
                Last_month=int(NVD_Last_Modified[0].split('/')[0])
                Last_day=int(NVD_Last_Modified[0].split('/')[1])
                NVD_Last_Modified=datetime.date(Last_year,Last_month,Last_day)
                print(NVD_Last_Modified)#最后修改日期
                Source=re.findall('vuln-current-description-source">(.*?)</span>',resp.text)
                timenow=strftime("%Y-%m-%d %H:%M:%S", gmtime())
                print(timenow)
                id=''
                if len(Source)==0:
                    pass
                Sourcewho=Source[0]
                print(Sourcewho)#发布者
                mysqlin(id,cvenumbe,Descriptiontxt,NISTname,Scorev3,CNAname,ScoreCNAnum,Scorev2,NVD_Published_Date_time,NVD_Last_Modified,Sourcewho,name,timenow)
            # if len(Score)==0 :
            #     # ScoreCNAnum=Score[0].split(' ')[0]#NVDv3分数
            #     # Scorev2=Score[1].split(' ')[0]#NVDv2分数
            #     CNA=re.findall('data-testid="vuln-cvss3-source-cna">(.*?)</span>',resp.text)
            #     NVD_Published_Date=re.findall('vuln-published-on">(.*?)</span>',resp.text)
            #     if len(NVD_Published_Date)==0:
            #         pass
            #     Published_yesr=int(NVD_Published_Date[0].split('/')[2])
            #     Published_month=int(NVD_Published_Date[0].split('/')[0])
            #     Published_day=int(NVD_Published_Date[0].split('/')[1])
            #     NVD_Published_Date_time=datetime.date(Published_yesr,Published_month,Published_day)
            #     CNAname=CNA[0]
            #     print(CNAname)#CNA名字
            #     Scorev3=''
            #     Scorev2=''
            #     ScoreCNAnum=''
            #     print('NVDV3:'+Scorev3,'CNA:'+ScoreCNAnum,'NVDV2:'+Scorev2)#分数
            #     print(NVD_Published_Date_time)#发布日期
            #     NVD_Last_Modified=re.findall('vuln-last-modified-on">(.*?)</span>',resp.text)
            #     if len(NVD_Last_Modified)==0:
            #         pass
            #     Last_year=int(NVD_Last_Modified[0].split('/')[2])
            #     Last_month=int(NVD_Last_Modified[0].split('/')[0])
            #     Last_day=int(NVD_Last_Modified[0].split('/')[1])
            #     NVD_Last_Modified=datetime.date(Last_year,Last_month,Last_day)
            #     print(NVD_Last_Modified)#最后修改日期
            #     Source=re.findall('vuln-current-description-source">(.*?)</span>',resp.text)
            #     timenow=strftime("%Y-%m-%d %H:%M:%S", gmtime())
            #     print(timenow)
            #     id=''
            #     if len(Source)==0:
            #         pass
            #     Sourcewho=Source[0]
            #     print(Sourcewho)#发布者
            #     mysqlin(id,cvenumbe,Descriptiontxt,NISTname,Scorev3,CNAname,ScoreCNAnum,Scorev2,NVD_Published_Date_time,NVD_Last_Modified,Sourcewho,name,timenow)

        CNA=re.findall('data-testid="vuln-cvss3-source-cna">(.*?)</span>',resp.text)
        if len(CNA)>0:
            CNAname=CNA[0]
            # print(CNAname)#CNA名字
            ScoreCNA=re.findall('class="label label-.*?">(.*?)</a>',resp.text)
            # print(ScoreCNA)
            if len(ScoreCNA)>2:
                Scorev3=ScoreCNA[0].split(' ')[0]
                ScoreCNAnum=ScoreCNA[1].split(' ')[0]
                Scorev2=ScoreCNA[2].split(' ')[0]
                # print('NVDV3:'+Scorev3,'CNA:'+ScoreCNAnum,'NVDV2:'+Scorev2)#分数
            if len(ScoreCNA)==1:
                Scorev3=''
                ScoreCNAnum=ScoreCNA[0].split(' ')[0]
                Scorev2=''
            if len(ScoreCNA)==0:
                Scorev3=''
                ScoreCNAnum=''
                Scorev2=''

            NVD_Published_Date=re.findall('vuln-published-on">(.*?)</span>',resp.text)
            if len(NVD_Published_Date)<1:
                #####
                Published_yesr=int(NVD_Published_Date[0].split('/')[2])
                Published_month=int(NVD_Published_Date[0].split('/')[0])
                Published_day=int(NVD_Published_Date[0].split('/')[1])
                NVD_Published_Date_time=datetime.date(Published_yesr,Published_month,Published_day)
                print(CNAname)#CNA名字
                print('NVDV3:'+Scorev3,'CNA:'+ScoreCNAnum,'NVDV2:'+Scorev2)#分数
                print(NVD_Published_Date_time)#发布日期
                NVD_Last_Modified=re.findall('vuln-last-modified-on">(.*?)</span>',resp.text)
                if len(NVD_Last_Modified)<1:
                    ####
                    NVD_Last_Modified=''
                    print(NVD_Last_Modified)#最后修改日期
                    Source=re.findall('vuln-current-description-source">(.*?)</span>',resp.text)
                    timenow=strftime("%Y-%m-%d %H:%M:%S", gmtime())
                    print(timenow)
                    id=''
                    if len(Source)==0:
                        Sourcewho=''
                        print(Sourcewho)#发布者
                        mysqlin(id,cvenumbe,Descriptiontxt,NISTname,Scorev3,CNAname,ScoreCNAnum,Scorev2,NVD_Published_Date_time,NVD_Last_Modified,Sourcewho,name,timenow)
                    Sourcewho=Source[0]
                    print(Sourcewho)#发布者
                    mysqlin(id,cvenumbe,Descriptiontxt,NISTname,Scorev3,CNAname,ScoreCNAnum,Scorev2,NVD_Published_Date_time,NVD_Last_Modified,Sourcewho,name,timenow)



                    ######
                Last_year=int(NVD_Last_Modified[0].split('/')[2])
                Last_month=int(NVD_Last_Modified[0].split('/')[0])
                Last_day=int(NVD_Last_Modified[0].split('/')[1])
                NVD_Last_Modified=datetime.date(Last_year,Last_month,Last_day)
                print(NVD_Last_Modified)#最后修改日期
                Source=re.findall('vuln-current-description-source">(.*?)</span>',resp.text)
                timenow=strftime("%Y-%m-%d %H:%M:%S", gmtime())
                print(timenow)
                id=''
                if len(Source)==0:
                    Sourcewho=''
                    print(Sourcewho)#发布者
                    mysqlin(id,cvenumbe,Descriptiontxt,NISTname,Scorev3,CNAname,ScoreCNAnum,Scorev2,NVD_Published_Date_time,NVD_Last_Modified,Sourcewho,name,timenow)
                Sourcewho=Source[0]
                print(Sourcewho)#发布者
                mysqlin(id,cvenumbe,Descriptiontxt,NISTname,Scorev3,CNAname,ScoreCNAnum,Scorev2,NVD_Published_Date_time,NVD_Last_Modified,Sourcewho,name,timenow)
                ######finsih
            Published_yesr=int(NVD_Published_Date[0].split('/')[2])
            Published_month=int(NVD_Published_Date[0].split('/')[0])
            Published_day=int(NVD_Published_Date[0].split('/')[1])
            NVD_Published_Date_time=datetime.date(Published_yesr,Published_month,Published_day)
            print(CNAname)#CNA名字
            print('NVDV3:'+Scorev3,'CNA:'+ScoreCNAnum,'NVDV2:'+Scorev2)#分数
            print(NVD_Published_Date_time)#发布日期
            NVD_Last_Modified=re.findall('vuln-last-modified-on">(.*?)</span>',resp.text)
            if len(NVD_Last_Modified)<1:
                ####
                NVD_Last_Modified=''
                print(NVD_Last_Modified)#最后修改日期
                Source=re.findall('vuln-current-description-source">(.*?)</span>',resp.text)
                timenow=strftime("%Y-%m-%d %H:%M:%S", gmtime())
                print(timenow)
                id=''
                if len(Source)==0:
                    Sourcewho=''
                    print(Sourcewho)#发布者
                    mysqlin(id,cvenumbe,Descriptiontxt,NISTname,Scorev3,CNAname,ScoreCNAnum,Scorev2,NVD_Published_Date_time,NVD_Last_Modified,Sourcewho,name,timenow)
                Sourcewho=Source[0]
                print(Sourcewho)#发布者
                mysqlin(id,cvenumbe,Descriptiontxt,NISTname,Scorev3,CNAname,ScoreCNAnum,Scorev2,NVD_Published_Date_time,NVD_Last_Modified,Sourcewho,name,timenow)



                ######
            Last_year=int(NVD_Last_Modified[0].split('/')[2])
            Last_month=int(NVD_Last_Modified[0].split('/')[0])
            Last_day=int(NVD_Last_Modified[0].split('/')[1])
            NVD_Last_Modified=datetime.date(Last_year,Last_month,Last_day)
            print(NVD_Last_Modified)#最后修改日期
            Source=re.findall('vuln-current-description-source">(.*?)</span>',resp.text)
            timenow=strftime("%Y-%m-%d %H:%M:%S", gmtime())
            print(timenow)
            id=''
            if len(Source)==0:
                Sourcewho=''
                print(Sourcewho)#发布者
                mysqlin(id,cvenumbe,Descriptiontxt,NISTname,Scorev3,CNAname,ScoreCNAnum,Scorev2,NVD_Published_Date_time,NVD_Last_Modified,Sourcewho,name,timenow)
            else:
                Sourcewho=Source[0]
                print(Sourcewho)#发布者
                mysqlin(id,cvenumbe,Descriptiontxt,NISTname,Scorev3,CNAname,ScoreCNAnum,Scorev2,NVD_Published_Date_time,NVD_Last_Modified,Sourcewho,name,timenow)
        else:
            CNAname=''
            # print(CNAname)#CNA名字
            ScoreCNA=re.findall('class="label label-.*?">(.*?)</a>',resp.text)
            # print(ScoreCNA)
            if len(ScoreCNA)>2:
                Scorev3=ScoreCNA[0].split(' ')[0]
                ScoreCNAnum=ScoreCNA[1].split(' ')[0]
                Scorev2=ScoreCNA[2].split(' ')[0]
                # print('NVDV3:'+Scorev3,'CNA:'+ScoreCNAnum,'NVDV2:'+Scorev2)#分数
            if len(ScoreCNA)==1:
                Scorev3=''
                ScoreCNAnum=ScoreCNA[0].split(' ')[0]
                Scorev2=''
            if len(ScoreCNA)==0:
                Scorev3=''
                ScoreCNAnum=''
                Scorev2=''

            NVD_Published_Date=re.findall('vuln-published-on">(.*?)</span>',resp.text)
            if len(NVD_Published_Date)<1:
                #####
                Published_yesr=int(NVD_Published_Date[0].split('/')[2])
                Published_month=int(NVD_Published_Date[0].split('/')[0])
                Published_day=int(NVD_Published_Date[0].split('/')[1])
                NVD_Published_Date_time=datetime.date(Published_yesr,Published_month,Published_day)
                print(CNAname)#CNA名字
                print('NVDV3:'+Scorev3,'CNA:'+ScoreCNAnum,'NVDV2:'+Scorev2)#分数
                print(NVD_Published_Date_time)#发布日期
                NVD_Last_Modified=re.findall('vuln-last-modified-on">(.*?)</span>',resp.text)
                if len(NVD_Last_Modified)<1:
                    ####
                    NVD_Last_Modified=''
                    print(NVD_Last_Modified)#最后修改日期
                    Source=re.findall('vuln-current-description-source">(.*?)</span>',resp.text)
                    timenow=strftime("%Y-%m-%d %H:%M:%S", gmtime())
                    print(timenow)
                    id=''
                    if len(Source)==0:
                        Sourcewho=''
                        print(Sourcewho)#发布者
                        mysqlin(id,cvenumbe,Descriptiontxt,NISTname,Scorev3,CNAname,ScoreCNAnum,Scorev2,NVD_Published_Date_time,NVD_Last_Modified,Sourcewho,name,timenow)
                    Sourcewho=Source[0]
                    print(Sourcewho)#发布者
                    mysqlin(id,cvenumbe,Descriptiontxt,NISTname,Scorev3,CNAname,ScoreCNAnum,Scorev2,NVD_Published_Date_time,NVD_Last_Modified,Sourcewho,name,timenow)



                    ######
                Last_year=int(NVD_Last_Modified[0].split('/')[2])
                Last_month=int(NVD_Last_Modified[0].split('/')[0])
                Last_day=int(NVD_Last_Modified[0].split('/')[1])
                NVD_Last_Modified=datetime.date(Last_year,Last_month,Last_day)
                print(NVD_Last_Modified)#最后修改日期
                Source=re.findall('vuln-current-description-source">(.*?)</span>',resp.text)
                timenow=strftime("%Y-%m-%d %H:%M:%S", gmtime())
                print(timenow)
                id=''
                if len(Source)==0:
                    Sourcewho=''
                    print(Sourcewho)#发布者
                    mysqlin(id,cvenumbe,Descriptiontxt,NISTname,Scorev3,CNAname,ScoreCNAnum,Scorev2,NVD_Published_Date_time,NVD_Last_Modified,Sourcewho,name,timenow)
                Sourcewho=Source[0]
                print(Sourcewho)#发布者
                mysqlin(id,cvenumbe,Descriptiontxt,NISTname,Scorev3,CNAname,ScoreCNAnum,Scorev2,NVD_Published_Date_time,NVD_Last_Modified,Sourcewho,name,timenow)
                ######finsih
            Published_yesr=int(NVD_Published_Date[0].split('/')[2])
            Published_month=int(NVD_Published_Date[0].split('/')[0])
            Published_day=int(NVD_Published_Date[0].split('/')[1])
            NVD_Published_Date_time=datetime.date(Published_yesr,Published_month,Published_day)
            print(CNAname)#CNA名字
            print('NVDV3:'+Scorev3,'CNA:'+ScoreCNAnum,'NVDV2:'+Scorev2)#分数
            print(NVD_Published_Date_time)#发布日期
            NVD_Last_Modified=re.findall('vuln-last-modified-on">(.*?)</span>',resp.text)
            if len(NVD_Last_Modified)<1:
                ####
                NVD_Last_Modified=''
                print(NVD_Last_Modified)#最后修改日期
                Source=re.findall('vuln-current-description-source">(.*?)</span>',resp.text)
                timenow=strftime("%Y-%m-%d %H:%M:%S", gmtime())
                print(timenow)
                id=''
                if len(Source)==0:
                    Sourcewho=''
                    print(Sourcewho)#发布者
                    mysqlin(id,cvenumbe,Descriptiontxt,NISTname,Scorev3,CNAname,ScoreCNAnum,Scorev2,NVD_Published_Date_time,NVD_Last_Modified,Sourcewho,name,timenow)
                Sourcewho=Source[0]
                print(Sourcewho)#发布者
                mysqlin(id,cvenumbe,Descriptiontxt,NISTname,Scorev3,CNAname,ScoreCNAnum,Scorev2,NVD_Published_Date_time,NVD_Last_Modified,Sourcewho,name,timenow)



                ######
            Last_year=int(NVD_Last_Modified[0].split('/')[2])
            Last_month=int(NVD_Last_Modified[0].split('/')[0])
            Last_day=int(NVD_Last_Modified[0].split('/')[1])
            NVD_Last_Modified=datetime.date(Last_year,Last_month,Last_day)
            print(NVD_Last_Modified)#最后修改日期
            Source=re.findall('vuln-current-description-source">(.*?)</span>',resp.text)
            timenow=strftime("%Y-%m-%d %H:%M:%S", gmtime())
            print(timenow)
            id=''
            if len(Source)==0:
                Sourcewho=''
                print(Sourcewho)#发布者
                mysqlin(id,cvenumbe,Descriptiontxt,NISTname,Scorev3,CNAname,ScoreCNAnum,Scorev2,NVD_Published_Date_time,NVD_Last_Modified,Sourcewho,name,timenow)
            else:
                Sourcewho=Source[0]
                print(Sourcewho)#发布者
                mysqlin(id,cvenumbe,Descriptiontxt,NISTname,Scorev3,CNAname,ScoreCNAnum,Scorev2,NVD_Published_Date_time,NVD_Last_Modified,Sourcewho,name,timenow) 
    if resp.status_code !=200:
        print('爬取失败，信息获取404') 
     
        
def mysqlin(id, cvenumbe, Description, NISTname, Scorev3, CNAname, ScoreCNAnum, Scorev2, NVD_Published_Date_time, NVD_Last_Modified, Sourcewho, name,timenow):
    print('连接到mysql服务器...')
    db = pymysql.connect(
        host="127.0.0.1",
        user="root",
        passwd="root",
        port=3306,
        db="cve",
        charset='utf8',
        cursorclass=pymysql.cursors.DictCursor)
    print('连接成功!')
    cursor = db.cursor()
    insert_color =("SELECT id FROM `cvedata` where cvenumber=%s")
    dese = (cvenumbe)
    cursor.execute(insert_color, dese)
    db.commit()
    result=cursor.fetchall()
    print(result)
    if len(result) == 0:
        insert_color = ("INSERT INTO `cvedata` (`id`, `cvenumber`, `description`,`nist`,`score3`,`cna`,`scorecnanum`,`score2`,`nvd_published_date`,`nvd_last_modified`,`sorce`,`name`,`time`) VALUES(%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s);")
        dese = (id, cvenumbe, Description, NISTname, Scorev3, CNAname, ScoreCNAnum,Scorev2, NVD_Published_Date_time, NVD_Last_Modified, Sourcewho, name,timenow)
        print(dese)
        cursor.execute(insert_color, dese)
        db.commit()
        result = cursor.fetchall()
        print(len(result))
        print('爬取数据成功')
    sleep1 = random.randint(0,3)  # 反爬，每次访问随机间隔5-10s
    print('程序休息：'+str(sleep1)+'秒')
    time.sleep(sleep1)
    


    

if __name__=='__main__':
    # while(True):
    print('Start!')
    count=1
    # name=input('请输入要爬取的厂商或者设备名称：')
    namecve=['D-Link','TP-Link','Juniper','Netgear','F5 BIG-IP','Belkin','Billion','DrayTek','Honeywell','ASUS','HUAWEI','Cisco','Xiaomi','OpenWrt','Tenda','MERCUSYS','MikroTik','DD-WRT','Vxworks','ZTE','Tomato','FreeRTOS','Hikvision','Dahua','360']
    for name in namecve:
        # print('爬取厂商：'+name)
        info(count,name)
    print('爬取结束!')
